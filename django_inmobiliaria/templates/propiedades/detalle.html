{% extends "base.html" %}
{% block title %}{{ p.titulo }}{% endblock %}
{% block content %}

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <!-- Galería -->
  <div>
    <img src="{{ p.imagen_principal.url }}" alt="{{ p.titulo }}" class="w-full h-72 object-cover rounded-2xl border">
    {% if imagenes %}
      <div class="mt-2 grid grid-cols-5 gap-2">
        {% for img in imagenes %}
          <img src="{{ img.imagen.url }}" alt="" class="h-20 w-full object-cover rounded-lg border">
        {% endfor %}
      </div>
    {% endif %}
  </div>

  <!-- Datos -->
  <div>
    <h1 class="text-2xl font-bold">{{ p.titulo }}</h1>
    <p class="text-lg text-gray-700 mt-1">{{ p.precio_display }}</p>

    <div class="mt-3 flex flex-wrap gap-2 text-sm">
      <span class="px-2 py-1 rounded-full border">🛏️ {{ p.habitaciones }} hab.</span>
      <span class="px-2 py-1 rounded-full border">🛁 {{ p.banos }} baño(s)</span>
      {% if p.cochera %}
        <span class="px-2 py-1 rounded-full border">🚗 Cochera</span>
      {% else %}
        <span class="px-2 py-1 rounded-full border bg-gray-100">🚗 No posee cochera</span>
      {% endif %}
      {% if p.acepta_mascotas %}
        <span class="px-2 py-1 rounded-full border">🐶 Acepta mascotas</span>
      {% else %}
        <span class="px-2 py-1 rounded-full border bg-gray-100">🐶 No acepta mascotas</span>
      {% endif %}
      {% if p.superficie_total %}<span class="px-2 py-1 rounded-full border">📐 {{ p.superficie_total }} m² tot.</span>{% endif %}
      {% if p.superficie_cubierta %}<span class="px-2 py-1 rounded-full border">🏢 {{ p.superficie_cubierta }} m² cub.</span>{% endif %}
    </div>

    <p class="mt-3 text-sm text-gray-600">📍 {{ p.direccion }}, {{ p.localidad }}, {{ p.provincia }}, {{ p.pais }}</p>

    <div class="prose max-w-none mt-4">
      <p>{{ p.descripcion|linebreaksbr }}</p>
    </div>
  </div>
</div>

<!-- Mapa -->
{% if p.latitud and p.longitud %}
  <div class="mt-6">
    <h2 class="font-semibold mb-2">Ubicación</h2>
    <div id="map" class="h-80 w-full rounded-2xl border"></div>
  </div>
{% endif %}

{% block extra_js %}
{% if p.latitud and p.longitud %}
  <!-- Leaflet CDN (para dev) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    (function(){
      const lat = {{ p.latitud|default:"null" }};
      const lng = {{ p.longitud|default:"null" }};
      if (lat && lng) {
        const map = L.map('map').setView([lat, lng], 15);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          maxZoom: 19, attribution: '&copy; OpenStreetMap'
        }).addTo(map);
        L.marker([lat, lng]).addTo(map).bindPopup("{{ p.titulo|escapejs }}");
      }
    })();
  </script>
{% endif %}
{% endblock %}
{% endblock %}
