{% extends "base.html" %}
{% block title %}Cerca mío{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-3">
  <h1 class="text-xl font-semibold">Propiedades cercanas</h1>
  <button id="btn-near" class="btn">Usar mi ubicación</button>
</div>

<p class="text-sm muted mb-3">
  Radio: {{ r|default:20 }} km
  {% if lat and lng %} — Centro: {{ lat }}, {{ lng }}{% endif %}
</p>

{% include "propiedades/_grid_list.html" %}

{% block extra_js %}
<script>
document.getElementById('btn-near')?.addEventListener('click', function(){
  if (!navigator.geolocation) { alert('Tu navegador no permite geolocalización.'); return; }
  navigator.geolocation.getCurrentPosition(function(pos){
    const lat = pos.coords.latitude.toFixed(6);
    const lng = pos.coords.longitude.toFixed(6);
    const r = {{ r|default:20 }};
    const url = new URL("{% url 'propiedades_cercanas' %}", window.location.origin);
    url.searchParams.set("lat", lat);
    url.searchParams.set("lng", lng);
    url.searchParams.set("r", r);
    window.location.href = url.toString();
  }, function(){
    alert('No pudimos obtener tu ubicación. Podés buscar por localidad o usar el mapa en el detalle.');
  });
});
</script>
{% endblock %}
{% endblock %}
